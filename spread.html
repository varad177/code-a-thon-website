<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CODE-A-THON 2025 Card Generator</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #050810;
        --secondary-color: #4361ee;
        --accent-color: #7209b7;
        --gradient-start: #7209b7;
        --gradient-end: #f8ca12;
        --dark-color: #0a0a15;
        --light-color: #f8f9fa;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--dark-color);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--light-color);
        padding: 20px;
      }

      .main-container {
        width: 100%;
        max-width: 1200px;
        display: flex;
        flex-direction: row;
        gap: 40px;
        margin: 0 auto;
      }

      .card-preview {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .form-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .form-section {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 30px;
        backdrop-filter: blur(10px);
      }

      .logo-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .logo {
        width: 120px;
        height: auto;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 40px;
        text-align: center;
        background: linear-gradient(
          to right,
          var(--gradient-start),
          var(--gradient-end)
        );
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 20px rgba(114, 9, 183, 0.3);
      }

      .form-label {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--light-color);
      }

      .form-control {
        width: 100%;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.05);
        color: white;
        font-size: 16px;
        margin-bottom: 20px;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px rgba(114, 9, 183, 0.3);
      }

      .form-select {
        width: 100%;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.05);
        color: white;
        font-size: 16px;
        margin-bottom: 20px;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 15px center;
      }
      .form-select option {
        background-color: #000;
      }

      .btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }

      .btn-primary {
        background: linear-gradient(
          45deg,
          var(--gradient-start),
          var(--gradient-end)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(114, 9, 183, 0.3);
      }

      .share-options {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .share-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
      }

      .share-btn-instagram {
        background: linear-gradient(45deg, #833ab4, #e1306c, #f77737);
        color: white;
      }

      .share-btn-whatsapp {
        background: #25d366;
        color: white;
      }

      .share-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      /* Card Design - Fixed */
      .card {
        position: relative;
        width: 100%;
        max-width: 380px;
        height: 600px;
        background-color: var(--primary-color);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
      }

      .card-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 1;
      }

      .card-background-text {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 30px;
        font-weight: 800;
        color: rgba(255, 255, 255, 0.03);
        text-transform: uppercase;
        line-height: 1;
        transform: rotate(0deg);
        user-select: none;
      }

      .card-background-text div {
        position: absolute;
        font-size: 36px;
        letter-spacing: 6px;
      }

      .logo-top {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 2;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-top img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 5px;
        border-radius: 50%;
      }

      .logo-top span {
        font-size: 12px;
        font-weight: 600;
        color: white;
      }

      .logo-partner {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 2;
      }

      .logo-partner img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 5px;
        border-radius: 50%;
      }

      /* Fixed user photo positioning with percentage-based calculations */
      .user-photo {
        position: absolute;
        top: 13%; /* Percentage of card height instead of fixed pixels */
        left: 5%;
        width: 26%; /* Percentage of card width for consistency */
        height: 0;
        padding-bottom: 26%; /* Keep it a circle with same width-to-height ratio */
        border-radius: 50%;
        overflow: hidden;
        z-index: 2;
        background-color: rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        border: 3px solid rgba(255, 255, 255, 0.2);
      }

      .user-photo img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      
      }

      .user-photo .placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 30px;
        color: rgba(255, 255, 255, 0.3);
      }

      .user-info {
        position: absolute;
        bottom: 20%; /* Percentage-based positioning */
        left: 5%;
        z-index: 2;
        width: 90%;
      }

      .user-name {
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        max-width: 100%;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        line-height: 1.2;
        margin-bottom: 10px;
      }

      .user-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--gradient-end);
        margin-bottom: 5px;
      }

      .website-url {
        position: absolute;
        bottom: 20px;
        left: 20px;
        z-index: 2;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
      }

      .maintext {
        font-size: 22px;
        position: absolute;
        top: 40%;
        left: 6%;
        z-index: 2;
      }
      
      .maintext span {
        color: var(--gradient-end);
      }

      /* Responsive */
      @media (max-width: 992px) {
        .main-container {
          flex-direction: column;
        }

        .card {
          margin: 0 auto 40px;
        }
      }

      @media (max-width: 576px) {
        .card {
          max-width: 320px;
          height: 500px;
        }

        .user-name {
          font-size: 2rem;
        }

        .user-title {
          font-size: 1.2rem;
        }
        
        /* Ensure the user photo scales correctly on small screens */
        .user-photo {
          top: 13%;
          left: 5%;
          width: 30%;
          padding-bottom: 30%;
        }
      }

      /* File input styling */
      .file-input-container {
        position: relative;
        width: 100%;
        height: 120px;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border: 2px dashed rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-input-container:hover {
        border-color: var(--accent-color);
        background-color: rgba(255, 255, 255, 0.05);
      }

      .file-input-container input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      .file-input-icon {
        font-size: 30px;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 10px;
      }

      .file-input-text {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
      }

      .file-input-selected {
        font-size: 12px;
        color: var(--accent-color);
        margin-top: 5px;
      }

      .inn {
        color: var(--gradient-end) !important;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="card-preview">
        <div class="card">
          <div class="card-background">
            <div class="card-background-text">
              <div style="top: 60px">CODE-A-THON</div>
              <div style="top: 120px">CODE-A-THON</div>
              <div style="top: 180px">CODE-A-THON</div>
              <div style="top: 240px">CODE-A-THON</div>
              <div style="top: 300px">CODE-A-THON</div>
              <div style="top: 360px">CODE-A-THON</div>
              <div style="top: 420px">CODE-A-THON</div>
              <div style="top: 480px">CODE-A-THON</div>
              <div style="top: 540px">CODE-A-THON</div>
              <div style="top: 600px">CODE-A-THON</div>
            </div>
          </div>

          <div class="logo-top">
            <img
              src="./assets/csiLogo/logo-code.png"
              alt="Logo"
              id="logo-image"
            />
            <span class="inn">Innovate Build, & Win!</span>
          </div>

          <div class="logo-partner">
            <img
              src="./assets/csiLogo/logo.webp"
              alt="Partner Logo"
              id="partner-logo"
            />
          </div>

          <div class="user-photo" id="preview-photo">
            <div class="placeholder">
              <i class="fas fa-user"></i>
            </div>
          </div>

          <h2 class="maintext">Ready For <br> <span style="font-size: 32px;">CODE A THON</span></h2>

          <div class="user-info">
            <div class="user-name" id="preview-name">Your Name</div>
            <div class="user-title" id="preview-title">Code Ninja</div>
          </div>

          <div class="website-url">www.code-a-thon-2025.vercel.app</div>
        </div>
      </div>

      <div class="form-container">
        <div class="form-section">
          <h1>CODE-A-THON 2025</h1>

          <div class="file-input-container" id="file-input-container">
            <input type="file" id="photo-input" accept="image/*" />
            <div class="file-input-icon">
              <i class="fas fa-camera"></i>
            </div>
            <div class="file-input-text">Select Your Image</div>
            <div class="file-input-selected" id="file-selected">
              No file chosen
            </div>
          </div>

          <label class="form-label" for="name-input">Enter Your Name</label>
          <input
            type="text"
            id="name-input"
            class="form-control"
            placeholder="Enter your name"
          />

          <label class="form-label" for="title-select"
            >Select Title for You</label
          >
          <select id="title-select" class="form-select">
            <option value="Code Ninja">Code Ninja</option>
            <option value="Super Hacker">Super Hacker</option>
            <option value="Dev Master">Dev Master</option>
            <option value="Tech Guru">Tech Guru</option>
            <option value="Algorithm Wizard">Algorithm Wizard</option>
          </select>

          <button id="generate-btn" class="btn btn-primary">
            Download as PNG
          </button>

          <div style="display: none;" class="share-options">
            <button id="share-instagram" class="share-btn share-btn-instagram">
              <i class="fab fa-instagram"></i> Instagram
            </button>
            <button id="share-whatsapp" class="share-btn share-btn-whatsapp">
              <i class="fab fa-whatsapp"></i> WhatsApp
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const photoInput = document.getElementById("photo-input");
        const fileSelected = document.getElementById("file-selected");
        const previewPhoto = document.getElementById("preview-photo");
        const nameInput = document.getElementById("name-input");
        const titleSelect = document.getElementById("title-select");
        const previewName = document.getElementById("preview-name");
        const previewTitle = document.getElementById("preview-title");
        const generateBtn = document.getElementById("generate-btn");
        const shareInstagram = document.getElementById("share-instagram");
        const shareWhatsApp = document.getElementById("share-whatsapp");
        const card = document.querySelector(".card");

        // Handle photo upload
        photoInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            fileSelected.textContent = file.name;
            const reader = new FileReader();
            reader.onload = function (e) {
              previewPhoto.innerHTML = `<img src="${e.target.result}" alt="Your photo">`;
            };
            reader.readAsDataURL(file);
          }
        });

        // Update preview name when input changes
        nameInput.addEventListener("input", function () {
          previewName.textContent = this.value || "Your Name";
        });

        // Update preview title when select changes
        titleSelect.addEventListener("change", function () {
          previewTitle.textContent = this.value;
        });

        function createCardImage() {
  return new Promise((resolve) => {
    // Create a visible clone in a position that won't affect the layout
    const cardClone = card.cloneNode(true);
    cardClone.style.position = 'fixed';
    cardClone.style.top = '0';
    cardClone.style.left = '0';
    cardClone.style.width = '380px';
    cardClone.style.height = '600px';
    cardClone.style.zIndex = '-9999';
    cardClone.style.visibility = 'visible'; // Make it visible but off-screen
    cardClone.style.opacity = '1';
    document.body.appendChild(cardClone);
    
    // Give more time for resources to load
    setTimeout(() => {
      html2canvas(cardClone, {
        backgroundColor: null,
        useCORS: true,
        scale: 2,
        allowTaint: true,
        logging: true, // Enable logging to help debug
        width: 380,
        height: 600
      }).then((canvas) => {
        const imgData = canvas.toDataURL("image/png");
        document.body.removeChild(cardClone);
        resolve(imgData);
      }).catch(err => {
        console.error("Error in html2canvas:", err);
        document.body.removeChild(cardClone);
        resolve(null);
      });
    }, 500); // Increased timeout to 500ms
  });
}
        // Generate and download image
        generateBtn.addEventListener("click", async function () {
          const imgData = await createCardImage();
          if (imgData) {
            downloadImage(imgData, "code-a-thon-card.png");
          } else {
            alert("There was an error generating your card. Please try again.");
          }
        });

        // Share to Instagram
        shareInstagram.addEventListener("click", async function () {
          const imgData = await createCardImage();
          if (!imgData) {
            alert("There was an error generating your card. Please try again.");
            return;
          }

          if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            // On mobile, try to open Instagram
            const blob = await (await fetch(imgData)).blob();
            const file = new File([blob], "code-a-thon-card.png", {
              type: "image/png",
            });

            if (navigator.share && navigator.canShare({ files: [file] })) {
              try {
                await navigator.share({
                  files: [file],
                  title: "Ready for CODE-A-THON 2025!",
                  text: "Join me at CODE-A-THON 2025! #codeathon #hackathon",
                });
              } catch (error) {
                downloadImage(imgData, "code-a-thon-card.png");
                alert(
                  "To share on Instagram: Save this image and upload it to your Instagram story."
                );
              }
            } else {
              downloadImage(imgData, "code-a-thon-card.png");
              alert(
                "To share on Instagram: Save this image and upload it to your Instagram story."
              );
            }
          } else {
            // On desktop, just download the image
            downloadImage(imgData, "code-a-thon-card.png");
            alert(
              "To share on Instagram: Save this image and upload it to your Instagram story."
            );
          }
        });

        // Share to WhatsApp
        shareWhatsApp.addEventListener("click", async function () {
          const imgData = await createCardImage();
          if (!imgData) {
            alert("There was an error generating your card. Please try again.");
            return;
          }

          // Try to use Web Share API first (mobile)
          if (navigator.share) {
            const blob = await (await fetch(imgData)).blob();
            const file = new File([blob], "code-a-thon-card.png", {
              type: "image/png",
            });

            if (navigator.canShare({ files: [file] })) {
              try {
                await navigator.share({
                  files: [file],
                  title: "Ready for CODE-A-THON 2025!",
                  text: "Join me at CODE-A-THON 2025! Visit: https://code-a-thon-2025.vercel.app/",
                });
                return;
              } catch (error) {
                console.error("Error sharing:", error);
              }
            }
          }

          // Fallback: download and provide WhatsApp link
          downloadImage(imgData, "code-a-thon-card.png");
          const text = encodeURIComponent(
            "Join me at CODE-A-THON 2025! Visit: https://code-a-thon-2025.vercel.app/"
          );
          window.open(`https://wa.me/?text=${text}`, "_blank");
        });

        // Helper function to download image
        function downloadImage(data, filename) {
          const link = document.createElement("a");
          link.href = data;
          link.download = filename;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }
      });
    </script>
  </body>
</html>